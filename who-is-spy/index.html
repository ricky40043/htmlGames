<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#ff6b6b">
    <title>🕵️ 誰是臥底 - QR Code推理遊戲</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- 歡迎頁面 -->
    <div id="welcome-page" class="page active">
        <div class="container">
            <h1>🕵️ 誰是臥底</h1>
            <p class="subtitle">QR Code版多人推理遊戲</p>
            
            <div class="game-features">
                <div class="feature-card">
                    <h3>📱 QR Code系統</h3>
                    <p>每位玩家專屬QR Code，掃描獲得身份</p>
                </div>
                <div class="feature-card">
                    <h3>🎭 身份隱藏</h3>
                    <p>平民vs臥底，誰能找出真相？</p>
                </div>
                <div class="feature-card">
                    <h3>🗳️ 投票淘汰</h3>
                    <p>討論後投票，淘汰可疑玩家</p>
                </div>
            </div>

            <div class="start-section">
                <button class="start-btn" onclick="showSetup()">創建房間</button>
                <button class="rules-btn" onclick="showRules()">遊戲規則</button>
            </div>
        </div>
    </div>

    <!-- 房間設定頁面 -->
    <div id="setup-page" class="page">
        <div class="container">
            <h2>🎮 房間設定</h2>
            
            <div class="setup-form">
                <div class="room-settings">
                    <h3>🏠 房間配置</h3>
                    <div class="setting-group">
                        <label for="room-name">房間名稱：</label>
                        <input type="text" id="room-name" placeholder="輸入房間名稱" maxlength="20">
                    </div>
                    
                    <div class="setting-group">
                        <label for="player-count">玩家人數：</label>
                        <select id="player-count" onchange="updateSpyCount()">
                            <option value="4">4人</option>
                            <option value="5">5人</option>
                            <option value="6" selected>6人</option>
                            <option value="7">7人</option>
                            <option value="8">8人</option>
                            <option value="9">9人</option>
                            <option value="10">10人</option>
                        </select>
                    </div>
                    
                    <div class="setting-group">
                        <label for="spy-count">臥底人數：</label>
                        <select id="spy-count">
                            <option value="1" selected>1人</option>
                            <option value="2">2人</option>
                        </select>
                    </div>
                    
                    <div class="setting-group">
                        <label for="discussion-time">討論時間：</label>
                        <select id="discussion-time">
                            <option value="60">1分鐘</option>
                            <option value="120" selected>2分鐘</option>
                            <option value="180">3分鐘</option>
                            <option value="300">5分鐘</option>
                            <option value="0">無限制</option>
                        </select>
                    </div>
                </div>

                <div class="game-settings">
                    <h3>⚙️ 遊戲設定</h3>
                    <div class="setting-group">
                        <label for="word-category">詞彙類別：</label>
                        <select id="word-category">
                            <option value="all" selected>隨機類別</option>
                            <option value="food">食物類</option>
                            <option value="animal">動物類</option>
                            <option value="object">物品類</option>
                            <option value="place">地點類</option>
                            <option value="activity">活動類</option>
                        </select>
                    </div>
                    
                    <div class="setting-group">
                        <label for="difficulty">難度等級：</label>
                        <select id="difficulty">
                            <option value="easy">簡單 (差異明顯)</option>
                            <option value="medium" selected>中等 (有些相似)</option>
                            <option value="hard">困難 (非常相似)</option>
                        </select>
                    </div>
                </div>

                <div class="setup-buttons">
                    <button class="btn-back" onclick="showWelcome()">返回</button>
                    <button class="btn-create" onclick="createRoom()">創建房間</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 房間等待頁面 -->
    <div id="waiting-page" class="page">
        <div class="container">
            <h2>🏠 房間：<span id="display-room-name">等待中</span></h2>
            
            <div class="room-info">
                <div class="room-status">
                    <h3>👥 玩家狀態 <span id="player-status">0/6</span></h3>
                    <div class="players-list" id="players-list">
                        <!-- 玩家列表動態生成 -->
                    </div>
                </div>
                
                <div class="room-details">
                    <h3>🎮 遊戲設定</h3>
                    <div class="setting-display">
                        <span>👥 人數：<span id="display-player-count">6</span>人</span>
                        <span>🕵️ 臥底：<span id="display-spy-count">1</span>人</span>
                        <span>⏰ 討論時間：<span id="display-discussion-time">2分鐘</span></span>
                        <span>📝 類別：<span id="display-category">隨機</span></span>
                    </div>
                </div>
            </div>

            <div class="room-actions">
                <button class="action-btn" onclick="showQRCodes()" id="start-game-btn" disabled>
                    開始遊戲
                </button>
                <button class="action-btn secondary" onclick="copyRoomLink()">
                    分享房間
                </button>
                <button class="action-btn danger" onclick="showWelcome()">
                    離開房間
                </button>
            </div>
        </div>
    </div>

    <!-- QR Code分發頁面 -->
    <div id="qr-page" class="page">
        <div class="container">
            <h2>📱 掃描QR Code獲得身份</h2>
            
            <div class="qr-instruction">
                <p>📱 每位玩家請用手機<strong>掃描</strong>屬於自己的QR Code</p>
                <p class="warning">⚠️ 掃描後手機會顯示你的身份和詞彙，請不要讓其他人看到！</p>
                <p class="tip">💡 使用手機相機或任何QR Code掃描APP掃描下方的QR Code</p>
                <p class="tip">🔍 如果掃描有困難，可以點擊「查看身份」按鈕作為備用</p>
            </div>

            <div class="current-player-indicator" id="current-player-indicator">
                <h3>👤 當前輪到：<span id="current-reveal-player">玩家1</span> 掃描QR Code</h3>
                <p style="margin: 0.5rem 0; color: #666;">請用手機掃描你的QR Code，或點擊「查看內容」按鈕</p>
                <button class="next-player-btn" onclick="nextPlayerReveal()">下一位玩家 →</button>
            </div>

            <div class="qr-gallery" id="qr-gallery">
                <!-- QR Code動態生成 -->
            </div>

            <div class="qr-controls">
                <button class="control-btn" onclick="regenerateQR()">🔄 重新分配身份</button>
                <button class="control-btn primary" onclick="startDiscussion()" id="start-discussion-btn" disabled>開始討論</button>
                <button class="control-btn" onclick="skipToDiscussion()">⏭️ 跳過查看階段</button>
            </div>
        </div>
    </div>

    <!-- 遊戲進行頁面 -->
    <div id="game-page" class="page">
        <div class="container">
            <div class="game-header">
                <h2>🎭 遊戲進行中</h2>
                <div class="game-status">
                    <span>回合：<span id="current-round">1</span></span>
                    <span>存活：<span id="alive-count">6</span>人</span>
                    <span id="timer-display">討論時間：2:00</span>
                </div>
            </div>

            <div class="game-area">
                <div class="discussion-phase" id="discussion-phase">
                    <h3>💬 討論階段</h3>
                    <p>請各位玩家輪流描述自己的詞彙，找出可疑的臥底！</p>
                    
                    <div class="timer-container">
                        <div class="timer-circle">
                            <span id="timer-text">2:00</span>
                        </div>
                        <div class="timer-bar" id="timer-bar"></div>
                    </div>
                </div>

                <div class="voting-phase" id="voting-phase" style="display: none;">
                    <h3>🗳️ 投票階段</h3>
                    <p>請選擇你認為是臥底的玩家</p>
                    
                    <div class="voting-grid" id="voting-grid">
                        <!-- 投票選項動態生成 -->
                    </div>
                    
                    <div class="voting-status">
                        <span>投票進度：<span id="vote-progress">0/6</span></span>
                    </div>
                </div>
            </div>

            <div class="game-controls">
                <button class="control-btn" onclick="skipDiscussion()" id="skip-btn">跳過討論</button>
                <button class="control-btn" onclick="endGame()">結束遊戲</button>
            </div>
        </div>
    </div>

    <!-- 結果頁面 -->
    <div id="result-page" class="page">
        <div class="container">
            <div class="result-header">
                <h1 id="result-title">🎉 遊戲結束</h1>
                <h2 id="winner-announcement">平民獲勝！</h2>
            </div>

            <div class="result-content">
                <div class="word-reveal">
                    <h3>📝 詞彙揭曉</h3>
                    <div class="word-display">
                        <div class="word-card civilian">
                            <h4>👥 平民詞彙</h4>
                            <span id="civilian-word">蘋果</span>
                        </div>
                        <div class="word-card spy">
                            <h4>🕵️ 臥底詞彙</h4>
                            <span id="spy-word">梨子</span>
                        </div>
                    </div>
                </div>

                <div class="players-reveal" id="players-reveal">
                    <h3>🎭 身份揭曉</h3>
                    <div class="players-identity">
                        <!-- 玩家身份揭曉 -->
                    </div>
                </div>

                <div class="game-summary">
                    <h3>📊 遊戲統計</h3>
                    <div class="summary-stats">
                        <span>遊戲時長：<span id="game-duration">5分30秒</span></span>
                        <span>回合數：<span id="total-rounds">3</span></span>
                        <span>淘汰人數：<span id="eliminated-count">2</span></span>
                    </div>
                </div>
            </div>

            <div class="result-actions">
                <button class="action-btn" onclick="playAgain()">再玩一次</button>
                <button class="action-btn" onclick="shareResult()">分享結果</button>
                <button class="action-btn" onclick="goHome()">返回首頁</button>
            </div>
        </div>
    </div>

    <!-- 規則說明頁面 -->
    <div id="rules-page" class="page">
        <div class="container">
            <h2>📋 遊戲規則</h2>
            
            <div class="rules-content">
                <div class="rule-section">
                    <h3>🎯 遊戲目標</h3>
                    <p><strong>平民：</strong>找出並淘汰所有臥底</p>
                    <p><strong>臥底：</strong>隱藏身份直到最後，或淘汰足夠的平民</p>
                </div>
                
                <div class="rule-section">
                    <h3>🎮 遊戲流程</h3>
                    <ol>
                        <li>房主創建房間並設定遊戲參數</li>
                        <li>玩家加入房間等待開始</li>
                        <li>每位玩家掃描專屬QR Code獲得身份和詞彙</li>
                        <li>討論階段：玩家輪流描述詞彙（不能直說）</li>
                        <li>投票階段：所有人投票淘汰可疑玩家</li>
                        <li>重複步驟4-5直到遊戲結束</li>
                    </ol>
                </div>
                
                <div class="rule-section">
                    <h3>🏆 勝利條件</h3>
                    <ul>
                        <li><strong>平民勝利：</strong>淘汰所有臥底</li>
                        <li><strong>臥底勝利：</strong>存活的臥底數量 ≥ 存活的平民數量</li>
                    </ul>
                </div>
                
                <div class="rule-section">
                    <h3>📱 QR Code說明</h3>
                    <ul>
                        <li>每個QR Code包含玩家專屬的身份和詞彙</li>
                        <li>QR Code外觀會有細微差異避免被識別</li>
                        <li>掃描後請立即收起手機，不要讓他人看到</li>
                        <li>如果意外看到他人詞彙，請主動說明</li>
                    </ul>
                </div>
                
                <div class="rule-section">
                    <h3>💡 遊戲技巧</h3>
                    <ul>
                        <li>描述詞彙時要精確但不能太明顯</li>
                        <li>注意觀察其他玩家的描述是否合理</li>
                        <li>臥底要仔細聽取平民的描述來推測詞彙</li>
                        <li>投票時要有邏輯和理由</li>
                    </ul>
                </div>
            </div>
            
            <div class="rules-actions">
                <button class="btn-back" onclick="showWelcome()">返回首頁</button>
                <button class="btn-start" onclick="showSetup()">開始遊戲</button>
            </div>
        </div>
    </div>

    <!-- QR Code庫 - 使用可用的CDN -->
    <script>
        // 載入QRious庫 (輕量級QR Code生成器)
        function loadQRCode() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js';
                script.onload = () => {
                    console.log('QRious library loaded successfully');
                    // QRious使用不同的API，需要設定相容性
                    window.QRCodeGenerator = QRious;
                    resolve();
                };
                script.onerror = () => {
                    console.warn('Primary CDN failed, trying backup...');
                    // 嘗試備用CDN
                    const backupScript = document.createElement('script');
                    backupScript.src = 'https://unpkg.com/qrious@4.0.2/dist/qrious.min.js';
                    backupScript.onload = () => {
                        console.log('QRious library loaded from backup CDN');
                        window.QRCodeGenerator = QRious;
                        resolve();
                    };
                    backupScript.onerror = () => {
                        console.warn('All CDNs failed, using fallback');
                        window.QRCodeGenerator = null;
                        resolve();
                    };
                    document.head.appendChild(backupScript);
                };
                document.head.appendChild(script);
            });
        }
        
        // 頁面載入時載入QR Code庫
        document.addEventListener('DOMContentLoaded', () => {
            loadQRCode().then(() => {
                console.log('Ready to generate QR codes');
            });
        });
    </script>
    <script src="words.js"></script>
    <script src="script.js"></script>
</body>
</html>